<form [formGroup]="form" (ngSubmit)="onSubmit()" *ngIf="material">
  <div class="form-group">
    <div class="form-row align-items-end">
      <div class="col" formGroupName="name">
        <label for="name">
          {{ 'forms.educationalResource.files.materialName.label.' + lang | translate }}*
        </label>

        <button
          type="button"
          class="btn btn-link"
          [tooltip]="'forms.educationalResource.files.materialName.tooltip' | translate"
        ><img src="assets/img/icons/ic_help.svg" alt=""></button>

        <input
          type="text"
          class="form-control"
          id="name"
          [formControlName]="lang"
          [ngClass]="{ 'is-invalid': submitted && nameCtrl.errors }"
        >

        <div *ngIf="submitted && nameCtrl.errors" class="invalid-feedback">
          <div *ngIf="nameCtrl.errors.required">{{ 'forms.common.required' | translate }}</div>
        </div>
      </div>

      <div class="col-auto">
        <button
          type="button"
          class="btn btn-gray"
          (click)="openTranslationsModal(nameI18n)"
        >{{ 'forms.common.translations.label' | translate }}</button>

        <button
          type="button"
          class="btn btn-link"
          [tooltip]="'forms.common.translations.tooltip' | translate"
        ><img src="assets/img/icons/ic_help.svg" alt=""></button>
      </div>
    </div>

    <ng-template #nameI18n>
      <div class="modal-header">
        <h5 class="modal-title">
          {{ 'forms.educationalResource.files.materialName.modal.title' | translate }}
        </h5>

        <button
          type="button"
          class="close"
          [attr.aria-label]="'forms.common.close' | translate"
          (click)="translationsModalRef.hide()"
        ><span aria-hidden="true">&times;</span></button>
      </div>

      <div class="modal-body" formGroupName="name">
        <h4>
          {{ 'forms.educationalResource.files.materialName.modal.subtitle' | translate }}
        </h4>

        <div class="form-group">
          <label for="name2">
            {{ 'forms.educationalResource.files.materialName.label.' + otherLangs[0] | translate }}
          </label>

          <input
            type="text"
            class="form-control"
            id="name2"
            [formControlName]="otherLangs[0]"
          >
        </div>

        <div class="form-group">
          <label for="name3">
            {{ 'forms.educationalResource.files.materialName.label.' + otherLangs[1] | translate }}
          </label>

          <input
            type="text"
            class="form-control"
            id="name3"
            [formControlName]="otherLangs[1]"
          >
        </div>
      </div>

      <div class="modal-footer">
        <button
          type="button"
          class="btn btn-gray"
          [attr.aria-label]="'forms.common.cancel' | translate"
          (click)="translationsModalRef.hide()"
        >{{ 'forms.common.cancel' | translate }}</button>

        <button
          type="button"
          class="btn btn-blue"
          (click)="translationsModalRef.hide()"
        >{{ 'forms.common.saveChanges' | translate }}</button>
      </div>
    </ng-template><!--/modal-->
  </div><!--/name-->

  <ng-container *ngFor="let file of fileDetailsArray.controls; let i = index;">
    <div class="form-group" formArrayName="fileDetails">
      <ng-container [formGroupName]="i">
        <h4>
          {{ i + 1 }}{{ 'forms.educationalResource.files.file.title' | translate }}
          <button
            type="button"
            class="btn btn-link"
            [tooltip]="'forms.educationalResource.files.file.tooltip' | translate"
          ><img src="assets/img/icons/ic_help.svg" alt=""></button>
        </h4>

        <div class="form-row align-items-end">
          <div class="form-group col-lg" *ngIf="file.get('file').value; else fileLink">
            <label for="{{ 'file' + i }}">
              {{ 'forms.educationalResource.files.file.inputs.file.label' | translate }}*
            </label>

            <input
              type="text"
              readonly
              class="form-control-plaintext"
              id="{{ 'file' + i }}"
              formControlName="file"
            >
          </div><!--/file-->

          <ng-template #fileLink>
            <div class="form-group col-lg">
              <label for="{{ 'link' + i }}">
                {{ 'forms.educationalResource.files.file.inputs.link.label' | translate }}*
              </label>

              <input
                type="url"
                class="form-control"
                id="{{ 'link' + i }}"
                formControlName="link"
                [ngClass]="{ 'is-invalid': submitted && file.get('link').errors }"
              >

              <div *ngIf="submitted && file.get('link').errors" class="invalid-feedback">
                <div *ngIf="file.get('link').errors.pattern">
                  {{ 'forms.common.pattern.url' | translate }}
                </div>
              </div>
            </div>
          </ng-template><!--/link-->

          <div class="form-group col-lg-2">
            <label for="{{ 'language' + i }}">
              {{ 'forms.educationalResource.files.file.inputs.language.label' | translate }}*
            </label>

            <button
              type="button"
              class="btn btn-link"
              [tooltip]="'forms.educationalResource.files.file.inputs.language.tooltip' | translate"
            ><img src="assets/img/icons/ic_help.svg" alt=""></button>

            <ng-select
              [items]="languages"
              bindLabel="value"
              bindValue="key"
              id="{{ 'language' + i }}"
              formControlName="language"
            ></ng-select>

            <ng-container *ngIf="submitted && file.get('language').errors">
              <div *ngIf="file.get('language').errors.required">
                <small class="text-danger">
                  {{ 'forms.common.required' | translate }}
                </small>
              </div>
            </ng-container>
          </div><!--/language-->
        </div>

        <div class="form-row align-items-end" formGroupName="displayName">
          <div class="form-group col">
            <label for="{{ 'displayName' + i }}">
              {{ 'forms.educationalResource.files.file.inputs.displayName.label.' + lang | translate }}*
            </label>

            <button
              type="button"
              class="btn btn-link"
              [tooltip]="'forms.educationalResource.files.file.inputs.displayName.tooltip' | translate"
            ><img src="assets/img/icons/ic_help.svg" alt=""></button>

            <input
              type="text"
              class="form-control"
              id="{{ 'displayName' + i }}"
              [formControlName]="lang"
              [ngClass]="{ 'is-invalid': submitted && fileDetailsArray.at(i).get('displayName.' + lang).errors }"
            >

            <div *ngIf="submitted && fileDetailsArray.at(i).get('displayName.' + lang).errors" class="invalid-feedback">
              <div *ngIf="fileDetailsArray.at(i).get('displayName.' + lang).errors.required">
                {{ 'forms.common.required' | translate }}
              </div>
            </div>
          </div>

          <div class="form-group col-auto">
            <button
              type="button"
              class="btn btn-gray"
              (click)="openTranslationsModal(displayName)"
            >{{ 'forms.common.translations.label' | translate }}</button>

            <button
              type="button"
              class="btn btn-link"
              [tooltip]="'forms.common.translations.tooltip' | translate"
            ><img src="assets/img/icons/ic_help.svg" alt=""></button>
          </div>

          <ng-template #displayName>
            <div class="modal-header">
              <h5 class="modal-title">
                {{ 'forms.educationalResource.files.file.inputs.displayName.modal.title' | translate }}
              </h5>

              <button
                type="button"
                class="close"
                [attr.aria-label]="'forms.common.close' | translate"
                (click)="translationsModalRef.hide()"
              ><span aria-hidden="true">&times;</span></button>
            </div>

            <div class="modal-body">
              <h4>
                {{ 'forms.educationalResource.files.file.inputs.displayName.modal.subtitle' | translate }}
              </h4>

              <div class="form-group">
                <label for="{{ 'displayName2' + i }}">
                  {{ 'forms.educationalResource.files.file.inputs.displayName.label.' + otherLangs[0] | translate }}
                </label>

                <input
                  type="text"
                  class="form-control"
                  id="{{ 'displayName2' + i }}"
                  [formControlName]="otherLangs[0]"
                >
              </div>

              <div class="form-group">
                <label for="{{ 'displayName3' + i }}">
                  {{ 'forms.educationalResource.files.file.inputs.displayName.label.' + otherLangs[1] | translate }}
                </label>

                <input
                  type="text"
                  class="form-control"
                  id="{{ 'displayName3' + i }}"
                  [formControlName]="otherLangs[1]"
                >
              </div>
            </div>

            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-gray"
                [attr.aria-label]="'forms.common.cancel' | translate"
                (click)="translationsModalRef.hide()"
              >{{ 'forms.common.cancel' | translate }}</button>

              <button
                type="button"
                class="btn btn-blue"
                (click)="translationsModalRef.hide()"
              >{{ 'forms.common.saveChanges' | translate }}</button>
            </div>
          </ng-template><!--/modal-->
        </div><!--/displayName-->
      </ng-container>
    </div>
  </ng-container><!--/files-->

  <div class="row justify-content-end">
    <div class="col-auto">
      <button
        type="button"
        class="btn btn-cancel"
        (click)="abort()"
      >{{ 'forms.common.abort' | translate }}</button>
    </div>

    <div class="col-auto">
      <button
        type="submit"
        class="btn btn-blue"
      >{{ 'forms.common.next' | translate }}</button>
    </div>
  </div>
</form>
