<div class="py-4 px-0" id="material-view">
  <div class="container">
    <ng-container *ngIf="educationalMaterial">
      <alert type="warning" *ngIf="expired">
        {{ 'demo.educationalMaterial.expired' | translate:{ date: educationalMaterial.expires | date:'d.M.yyyy' } }}
      </alert>

      <div class="row mb-4">
        <div class="col-lg-6">
          <h1>{{ materialName }}</h1>
        </div>

        <div class="col-lg-6 text-lg-right">
          <div class="material-actions">
            <ng-container *ngIf="authSvc.hasUserdata()">
              <button
                type="button"
                class="btn btn-link"
                (click)="openCollectionModal()"
              >{{ 'demo.educationalMaterial.addToCollection' | translate }}</button>
            </ng-container>

            <ng-container *ngIf="educationalMaterial.owner">
              <a class="btn btn-link" [routerLink]="['/muokkaa-oppimateriaalia', materialId]">
                <i class="fa fa-fw fa-edit text-dark" aria-hidden="true"></i>
                {{ 'demo.educationalMaterial.edit' | translate }}
              </a>
            </ng-container>

            <a class="btn btn-link" [href]="downloadUrl" download>
              <i class="fa fa-fw fa-download text-dark" aria-hidden="true"></i>
              {{ 'demo.educationalMaterial.download' | translate }}
            </a>
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-lg-3">
          <div class="material-sidebar-left">
            <div class="row">
              <div class="col-auto col-lg-12 text-center text-sm-left">
                <img
                  [src]="educationalMaterial.thumbnail"
                  class="img-fluid mb-4"
                  [alt]="'demo.educationalMaterial.cover.alt' | translate"
                >
              </div>

              <div class="col">
                <ul class="list-unstyled">
                  <li *ngFor="let type of educationalMaterial.learningResourceTypes">
                    <img
                      src="assets/img/icons/learning-resource-types/{{ type.learningresourcetypekey }}.svg"
                      class="img-icon"
                      aria-hidden="true"
                    > {{ type.value }}
                  </li>
                  <!--<li class="text-muted">
                    <i class="fa fa-fw fa-eye" aria-hidden="true"></i>
                    0 {{ 'demo.educationalMaterial.viewCount' | translate }}
                  </li>
                  <li class="text-muted">
                    <i class="fa fa-fw fa-download" aria-hidden="true"></i>
                    0 {{ 'demo.educationalMaterial.downloadCount' | translate }}
                  </li>-->
                </ul>
              </div>
            </div>
          </div>
        </div>

        <div class="col-12 col-lg-9">
          <div class="material-content">
            <div class="material-description">
              <ul class="list-unstyled authors">
                <li *ngFor="let author of educationalMaterial.authors">
                  <ng-container *ngIf="author.authorname !== ''">
                    {{ author.authorname }}
                    <ng-container *ngIf="author.organization">({{ author.organization }})</ng-container>
                  </ng-container>
                  <ng-container *ngIf="author.authorname === ''">{{ author.organization }}</ng-container>
                </li>
              </ul>

              <div class="datetimes">
                <span class="datetime-item d-block d-md-inline-block">
                  <strong id="createdAt">{{ 'demo.educationalMaterial.createdAt' | translate }}:</strong>

                  <time
                    [attr.datetime]="educationalMaterial.createdAt | date:'yyyy-MM-dd HH:mm'"
                    aria-labelledby="createdAt"
                  >
                    {{ educationalMaterial.createdAt | date:'d.M.yyyy HH:mm' }}
                  </time>
                </span>

                <span class="datetime-item d-block d-md-inline-block" *ngIf="educationalMaterial.publishedAt">
                  <strong id="publishedAt">{{ 'demo.educationalMaterial.publishedAt' | translate }}:</strong>

                  <time
                    [attr.datetime]="educationalMaterial.publishedAt | date:'yyyy-MM-dd HH:mm'"
                    aria-labelledby="publishedAt"
                  >
                    {{ educationalMaterial.publishedAt | date:'d.M.yyyy HH:mm' }}
                  </time>
                </span>

                <span class="datetime-item d-block d-md-inline-block" *ngIf="educationalMaterial.updatedAt">
                  <strong id="updatedAt">{{ 'demo.educationalMaterial.updatedAt' | translate }}:</strong>

                  <time
                    [attr.datetime]="educationalMaterial.updatedAt | date:'yyyy-MM-dd HH:mm'"
                    aria-labelledby="updatedAt"
                  >
                    {{ educationalMaterial.updatedAt | date:'d.M.yyyy HH:mm' }}
                  </time>
                </span>
              </div>

              <p *ngIf="description">{{ description }}</p>
            </div>

            <div class="list-files mb-4" *ngIf="materials.length > 0">
              <div class="row no-gutters">
                <div class="col-md-3">
                  <ng-container *ngIf="materialLanguages.length > 1">
                    <h3 id="selectLanguage">{{ 'materialPreview.selectLanguage' | translate }}</h3>

                    <div class="btn-group mb-3" role="group" aria-labelledby="selectLanguage">
                      <button
                        type="button"
                        class="btn btn-gray"
                        *ngFor="let lang of materialLanguages"
                        [ngClass]="lang === selectedLanguage ? 'active' : ''"
                        [attr.aria-selected]="lang === selectedLanguage"
                        [attr.aria-controls]="'fileList-' + lang"
                        [id]="'langSelector-' + lang"
                        role="tab"
                        (click)="setSelectedLanguage(lang)"
                      >{{ lang }}</button>
                    </div>
                  </ng-container>

                  <div
                    *ngIf="materials | materialLanguage:selectedLanguage as filteredMaterials"
                    [id]="'fileList-' + selectedLanguage"
                    role="tabpanel"
                    [attr.aria-labelledby]="'langSelector-' + selectedLanguage"
                  >
                    <h3 id="selectMaterial" [ngClass]="filteredMaterials.length === 1 ? 'sr-only' : ''">
                      {{ 'materialPreview.selectMaterial' | translate }}
                    </h3>

                    <div class="btn-group-vertical" role="group" aria-labelledby="selectMaterial">
                      <ng-container *ngFor="let material of filteredMaterials">
                        <button
                          type="button"
                          class="btn btn-file text-dark"
                          [ngClass]="material === previewMaterial ? 'active' : ''"
                          [attr.aria-selected]="material === previewMaterial"
                          [attr.aria-controls]="'filePreview-' + material.id"
                          [id]="'fileSelector-' + material.id"
                          role="tab"
                          (click)="setPreviewMaterial(material)"
                        >{{ material.displayName[lang] }}</button>
                      </ng-container>
                    </div>
                  </div>
                </div>

                <div class="col-md-9">
                  <div
                    [id]="'filePreview-' + previewMaterial.id"
                    role="tabpanel"
                    [attr.aria-labelledby]="'fileSelector-' + previewMaterial.id"
                  >
                    <app-educational-material-preview
                      [material]="previewMaterial"
                      *ngIf="!previewMaterial.link; else linkPreview"></app-educational-material-preview>

                    <ng-template #linkPreview>
                      <div class="link-preview">
                        <a
                          [href]="previewMaterial.link"
                          class="btn btn-secondary"
                          target="_blank"
                          rel="noopener nofollow"
                        >{{ 'demo.educationalMaterial.preview.openInNewTab' | translate }}</a>
                      </div>
                    </ng-template>
                  </div>
                </div>
              </div>
            </div>

            <div class="embed-code">
              <h4>{{ 'demo.educationalMaterial.embed.label' | translate }}</h4>

              <div class="input-group mb-4">
                <input
                  type="text"
                  class="form-control"
                  id="embedCodeInput"
                  [attr.aria-label]="'demo.educationalMaterial.embed.label' | translate"
                  [value]="embedCode"
                  readonly
                  #embedCodeInput
                  (focus)="$event.target.select()"
                >

                <div class="input-group-append">
                  <button
                    class="btn"
                    type="button"
                    [ngxClipboard]="embedCodeInput"
                    (cbOnSuccess)="embedCodeCopied = true"
                    [ngClass]="{
                      'btn-outline-secondary': !embedCodeCopied,
                      'btn-success': embedCodeCopied
                    }"
                  >
                    <ng-container *ngIf="!embedCodeCopied; else copied">
                      {{ 'demo.educationalMaterial.embed.copy' | translate }}
                    </ng-container>

                    <ng-template #copied>
                      {{ 'demo.educationalMaterial.embed.copied' | translate }}
                    </ng-template>
                  </button>
                </div>
              </div>
            </div>

            <div class="metadata">
              <div class="row">
                <div *ngIf="educationalMaterial.timeRequired" class="col-auto">
                  <h4>{{ 'demo.educationalMaterial.timeRequired' | translate }}</h4>
                  {{ educationalMaterial.timeRequired }}
                </div>

                <div *ngIf="educationalMaterial.publisher" class="col-auto">
                  <h4>{{ 'demo.educationalMaterial.publisher' | translate }}</h4>
                  {{ educationalMaterial.publisher }}
                </div>

              <div class="col-auto">
                <h4>{{ 'demo.educationalMaterial.license' | translate }}</h4>
                {{ educationalMaterial.license.value }}
              </div>

                <div class="col-12">
                  <h4>{{ 'demo.educationalMaterial.keywords' | translate }}</h4>

                  <div class="tags">
                    <button
                      *ngFor="let keyword of educationalMaterial.keywords"
                      type="button"
                      class="btn btn-light disabled"
                      disabled
                    >{{ keyword.value }}</button>
                  </div>
                </div>
              </div>

              <accordion>
                <accordion-group (isOpenChange)="detailsExpanded = !detailsExpanded">
                  <button type="button" class="btn btn-link" accordion-heading >
                    <ng-container *ngIf="detailsExpanded; else more">
                      {{ 'demo.educationalMaterial.expandMetadata.less' | translate }}
                    </ng-container>

                    <ng-template #more>
                      {{ 'demo.educationalMaterial.expandMetadata.more' | translate }}
                    </ng-template>
                  </button>
                  <div class="metadata-group">
                    <h4>{{ 'demo.educationalMaterial.eduLevel' | translate }}</h4>

                    <div class="tags">
                      <button
                        *ngFor="let level of educationalMaterial.educationalLevels"
                        type="button"
                        class="btn btn-light disabled"
                        disabled
                      >{{ level.value }}</button>
                    </div>
                  </div>

                  <div *ngIf="educationalMaterial.educationalRoles?.length > 0" class="metadata-group">
                    <h4>{{ 'demo.educationalMaterial.educationalRole' | translate }}</h4>

                    <div class="tags">
                      <button
                        *ngFor="let role of educationalMaterial.educationalRoles"
                        type="button"
                        class="btn btn-light disabled"
                        disabled
                      >{{ role.educationalrole }}</button>
                    </div>
                  </div>

                  <div *ngIf="educationalMaterial.educationalUses?.length > 0" class="metadata-group">
                    <h4>{{ 'demo.educationalMaterial.educationalUse' | translate }}</h4>

                    <div class="tags">
                      <button
                        *ngFor="let use of educationalMaterial.educationalUses"
                        type="button"
                        class="btn btn-light disabled"
                        disabled
                      >{{ use.value }}</button>
                    </div>
                  </div>

                  <!-- early childhood education -->
                  <div *ngIf="educationalMaterial.earlyChildhoodEducationSubjects.length > 0" class="metadata-group">
                    <h4>{{ 'demo.educationalMaterial.earlyChildhoodEducationSubjects' | translate }}</h4>

                    <div class="tags">
                      <button
                        *ngFor="let subject of educationalMaterial.earlyChildhoodEducationSubjects"
                        type="button"
                        class="btn btn-light disabled"
                        disabled
                      >{{ subject.targetName }}</button>
                    </div>
                  </div>

                  <div *ngIf="educationalMaterial.earlyChildhoodEducationObjectives.length > 0" class="metadata-group">
                    <h4>{{ 'demo.educationalMaterial.earlyChildhoodEducationObjectives' | translate }}</h4>

                    <div class="tags">
                      <button
                        *ngFor="let objective of educationalMaterial.earlyChildhoodEducationObjectives"
                        type="button"
                        class="btn btn-light disabled"
                        disabled
                      >{{ objective.targetName }}</button>
                    </div>
                  </div>

                  <!-- pre primary education -->
                  <div *ngIf="educationalMaterial.prePrimaryEducationSubjects.length > 0" class="metadata-group">
                    <h4>{{ 'demo.educationalMaterial.prePrimaryEducationSubjects' | translate }}</h4>

                    <div class="tags">
                      <button
                        *ngFor="let subject of educationalMaterial.prePrimaryEducationSubjects"
                        type="button"
                        class="btn btn-light disabled"
                        disabled
                      >{{ subject.targetName }}</button>
                    </div>
                  </div>

                  <div *ngIf="educationalMaterial.prePrimaryEducationObjectives.length > 0" class="metadata-group">
                    <h4>{{ 'demo.educationalMaterial.prePrimaryEducationObjectives' | translate }}</h4>

                    <div class="tags">
                      <button
                        *ngFor="let objective of educationalMaterial.prePrimaryEducationObjectives"
                        type="button"
                        class="btn btn-light disabled"
                        disabled
                      >{{ objective.targetName }}</button>
                    </div>
                  </div>

                  <!-- basic education -->
                  <div *ngIf="educationalMaterial.basicStudySubjects.length > 0" class="metadata-group">
                    <h4>{{ 'demo.educationalMaterial.basicStudySubjects' | translate }}</h4>

                    <div class="tags">
                      <button
                        *ngFor="let subject of educationalMaterial.basicStudySubjects"
                        type="button"
                        class="btn btn-light disabled"
                        disabled
                      >{{ subject.targetName }}</button>
                    </div>
                  </div>

                  <div *ngIf="educationalMaterial.basicStudyObjectives.length > 0" class="metadata-group">
                    <h4>{{ 'demo.educationalMaterial.basicStudyObjectives' | translate }}</h4>

                    <div class="tags">
                      <button
                        *ngFor="let objective of educationalMaterial.basicStudyObjectives"
                        type="button"
                        class="btn btn-light disabled"
                        disabled
                      >{{ objective.targetName }}</button>
                    </div>
                  </div>

                  <div *ngIf="educationalMaterial.basicStudyContents.length > 0" class="metadata-group">
                    <h4>{{ 'demo.educationalMaterial.basicStudyContents' | translate }}</h4>

                    <div class="tags">
                      <button
                        *ngFor="let content of educationalMaterial.basicStudyContents"
                        type="button"
                        class="btn btn-light disabled"
                        disabled
                      >{{ content.targetName }}</button>
                    </div>
                  </div>

                  <!-- upper secondary education -->
                  <div *ngIf="educationalMaterial.upperSecondarySchoolSubjects.length > 0" class="metadata-group">
                    <h4>{{ 'demo.educationalMaterial.upperSecondarySchoolSubjects' | translate }}</h4>

                    <div class="tags">
                      <button
                        *ngFor="let subject of educationalMaterial.upperSecondarySchoolSubjects"
                        type="button"
                        class="btn btn-light disabled"
                        disabled
                      >{{ subject.targetName }}</button>
                    </div>
                  </div>

                  <div *ngIf="educationalMaterial.upperSecondarySchoolObjectives.length > 0" class="metadata-group">
                    <h4>{{ 'demo.educationalMaterial.upperSecondarySchoolObjectives' | translate }}</h4>

                    <div class="tags">
                      <button
                        *ngFor="let objective of educationalMaterial.upperSecondarySchoolObjectives"
                        type="button"
                        class="btn btn-light disabled"
                        disabled
                      >{{ objective.targetName }}</button>
                    </div>
                  </div>

                  <!-- upper secondary education (new) -->
                  <div *ngIf="educationalMaterial.upperSecondarySchoolSubjectsNew.length > 0" class="metadata-group">
                    <h4>{{ 'demo.educationalMaterial.upperSecondarySchoolSubjectsNew' | translate }}</h4>

                    <div class="tags">
                      <button
                        *ngFor="let subject of educationalMaterial.upperSecondarySchoolSubjectsNew"
                        type="button"
                        class="btn btn-light disabled"
                        disabled
                      >{{ subject.targetName }}</button>
                    </div>
                  </div>

                  <div *ngIf="educationalMaterial.upperSecondarySchoolModulesNew.length > 0" class="metadata-group">
                    <h4>{{ 'demo.educationalMaterial.upperSecondarySchoolModulesNew' | translate }}</h4>

                    <div class="tags">
                      <button
                        *ngFor="let module of educationalMaterial.upperSecondarySchoolModulesNew"
                        type="button"
                        class="btn btn-light disabled"
                        disabled
                      >{{ module.targetName }}</button>
                    </div>
                  </div>

                  <div *ngIf="educationalMaterial.upperSecondarySchoolObjectivesNew.length > 0" class="metadata-group">
                    <h4>{{ 'demo.educationalMaterial.upperSecondarySchoolObjectivesNew' | translate }}</h4>

                    <div class="tags">
                      <button
                        *ngFor="let objective of educationalMaterial.upperSecondarySchoolObjectivesNew"
                        type="button"
                        class="btn btn-light disabled"
                        disabled
                      >{{ objective.targetName }}</button>
                    </div>
                  </div>

                  <div *ngIf="educationalMaterial.upperSecondarySchoolContentsNew.length > 0" class="metadata-group">
                    <h4>{{ 'demo.educationalMaterial.upperSecondarySchoolContentsNew' | translate }}</h4>

                    <div class="tags">
                      <button
                        *ngFor="let content of educationalMaterial.upperSecondarySchoolContentsNew"
                        type="button"
                        class="btn btn-light disabled"
                        disabled
                      >{{ content.targetName }}</button>
                    </div>
                  </div>

                  <!-- vocational education -->
                  <div *ngIf="educationalMaterial.vocationalDegrees.length > 0" class="metadata-group">
                    <h4>{{ 'demo.educationalMaterial.vocationalDegrees' | translate }}</h4>

                    <div class="tags">
                      <button
                        *ngFor="let degree of educationalMaterial.vocationalDegrees"
                        type="button"
                        class="btn btn-light disabled"
                        disabled
                      >{{ degree.targetName }}</button>
                    </div>
                  </div>

                  <div *ngIf="educationalMaterial.vocationalUnits.length > 0" class="metadata-group">
                    <h4>{{ 'demo.educationalMaterial.vocationalUnits' | translate }}</h4>

                    <div class="tags">
                      <button
                        *ngFor="let unit of educationalMaterial.vocationalUnits"
                        type="button"
                        class="btn btn-light disabled"
                        disabled
                      >{{ unit.targetName }}</button>
                    </div>
                  </div>

                  <div *ngIf="educationalMaterial.vocationalEducationObjectives.length > 0" class="metadata-group">
                    <h4>{{ 'demo.educationalMaterial.vocationalEducationObjectives' | translate }}</h4>

                    <div class="tags">
                      <button
                        *ngFor="let objective of educationalMaterial.vocationalEducationObjectives"
                        type="button"
                        class="btn btn-light disabled"
                        disabled
                      >{{ objective.targetName }}</button>
                    </div>
                  </div>

                  <!-- self-motivated education -->
                  <div *ngIf="educationalMaterial.selfMotivatedEducationSubjects.length > 0" class="metadata-group">
                    <h4>{{ 'demo.educationalMaterial.selfMotivatedEducationSubjects' | translate }}</h4>

                    <div class="tags">
                      <button
                        *ngFor="let subject of educationalMaterial.selfMotivatedEducationSubjects"
                        type="button"
                        class="btn btn-light disabled"
                        disabled
                      >{{ subject.targetName }}</button>
                    </div>
                  </div>

                  <div *ngIf="educationalMaterial.selfMotivatedEducationObjectives.length > 0" class="metadata-group">
                    <h4>{{ 'demo.educationalMaterial.selfMotivatedEducationObjectives' | translate }}</h4>

                    <div class="tags">
                      <button
                        *ngFor="let objective of educationalMaterial.selfMotivatedEducationObjectives"
                        type="button"
                        class="btn btn-light disabled"
                        disabled
                      >{{ objective.targetName }}</button>
                    </div>
                  </div>

                  <!-- higher education -->
                  <div *ngIf="educationalMaterial.branchesOfScience.length > 0" class="metadata-group">
                    <h4>{{ 'demo.educationalMaterial.branchesOfScience' | translate }}</h4>

                    <div class="tags">
                      <button
                        *ngFor="let branch of educationalMaterial.branchesOfScience"
                        type="button"
                        class="btn btn-light disabled"
                        disabled
                      >{{ branch.targetName }}</button>
                    </div>
                  </div>

                  <div *ngIf="educationalMaterial.scienceBranchObjectives.length > 0" class="metadata-group">
                    <h4>{{ 'demo.educationalMaterial.scienceBranchObjectives' | translate }}</h4>

                    <div class="tags">
                      <button
                        *ngFor="let objective of educationalMaterial.scienceBranchObjectives"
                        type="button"
                        class="btn btn-light disabled"
                        disabled
                      >{{ objective.targetName }}</button>
                    </div>
                  </div>

                  <!-- prerequisites -->
                  <div *ngIf="educationalMaterial.prerequisites.length > 0" class="metadata-group">
                    <h4>{{ 'demo.educationalMaterial.prerequisites' | translate }}</h4>

                    <div class="tags">
                      <button
                        *ngFor="let prerequisite of educationalMaterial.prerequisites"
                        type="button"
                        class="btn btn-light disabled"
                        disabled
                      >{{ prerequisite.targetName }}</button>
                    </div>
                  </div>

                  <!-- accessibility -->
                  <div *ngIf="educationalMaterial.accessibilityFeatures.length > 0" class="metadata-group">
                    <h4>{{ 'demo.educationalMaterial.accessibilityFeatures' | translate }}</h4>

                    <div class="tags">
                      <button
                        *ngFor="let feature of educationalMaterial.accessibilityFeatures"
                        type="button"
                        class="btn btn-light disabled"
                        disabled
                      >{{ feature.value }}</button>
                    </div>
                  </div>

                  <div *ngIf="educationalMaterial.accessibilityHazards.length > 0" class="metadata-group">
                    <h4>{{ 'demo.educationalMaterial.accessibilityHazard' | translate }}</h4>

                    <div class="tags">
                      <button
                        *ngFor="let hazard of educationalMaterial.accessibilityHazards"
                        type="button"
                        class="btn btn-light disabled"
                        disabled
                      >{{ hazard.value }}</button>
                    </div>
                  </div>
                </accordion-group>
              </accordion>
            </div>
          </div>

          <div class="ratings">
            <h2>{{ 'demo.educationalMaterial.userReviews.title' | translate }}</h2>

            <div class="row">
              <div *ngIf="educationalMaterial.ratingContentAverage" class="col-auto">
                <strong>{{ 'demo.educationalMaterial.userReviews.ratingContent' | translate }}:</strong>
                {{ educationalMaterial.ratingContentAverage }}
                <span class="text-muted">/ 5</span>
              </div>

              <div *ngIf="educationalMaterial.ratingVisualAverage" class="col-auto">
                <strong>{{ 'demo.educationalMaterial.userReviews.ratingVisual' | translate }}:</strong>
                {{ educationalMaterial.ratingVisualAverage }}
                <span class="text-muted">/ 5</span>
              </div>

              <div class="col-auto">
                <a routerLink="arvostelut">
                  {{ 'demo.educationalMaterial.userReviews.allReviews' | translate }}
                </a>
              </div>

              <div class="col-auto" *ngIf="authSvc.hasUserdata() && !educationalMaterial.owner">
                <button
                  type="button"
                  class="btn btn-anchor"
                  (click)="openReviewModal()"
                >{{ 'demo.educationalMaterial.userReviews.addReview' | translate }}</button>
              </div>
            </div>
          </div>

          <div class="references" *ngIf="educationalMaterial.references?.length > 0">
            <h2>{{ 'demo.educationalMaterial.references.title' | translate }}</h2>

            <div class="reference" *ngFor="let reference of educationalMaterial.references">
              <div class="row">
                <div class="col">
                  <strong>{{ reference.name }}</strong>

                  <ul class="list-unstyled mb-0">
                    <li *ngFor="let author of reference.authors">{{ author }}</li>
                  </ul>
                </div>

                <div class="col-auto">
                  <i class="fa fa-external-link mr-2" aria-hidden="true"></i>
                  <a [href]="reference.url" target="_blank" rel="noopener" class="text-blue">{{ 'demo.educationalMaterial.references.openLink' | translate }}</a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </ng-container>
  </div>
</div>
