<div class="py-4 px-0" id="material-view">
  <div class="container">
    <ng-container *ngIf="collection">
      <div class="row mb-4">
        <!--@todo: col-lg-6 with actions-->
        <div class="col-lg-12">
          <h1>{{ collection.collection.name }}</h1>
        </div>

        <!--@todo: add actions-->
        <!--<div class="col-lg-6 text-lg-right">
          muokkaa / poista / lataa
        </div>-->
      </div>

      <ng-container *ngIf="collection.educationalmaterials.length > 0; else noMaterials">
        <div class="collection-material border-top" *ngFor="let collectionMaterial of collection.educationalmaterials; let i = index">
          <h2>
            <a [routerLink]="['/materiaali', collectionMaterial.id]">
              {{ collectionMaterial.name[lang] }}
            </a>
          </h2>

          <ul class="list-unstyled authors">
            <li *ngFor="let author of collectionMaterial.author">
              <ng-container *ngIf="author.authorname !== ''; else organizationAuthor">
                {{ author.authorname }}
                <ng-container *ngIf="author.organization">({{ author.organization }})</ng-container>
              </ng-container>

              <ng-template #organizationAuthor>
                {{ author.organization }}
              </ng-template>
            </li>
          </ul>

          <div *ngIf="materialsLoading.get(collectionMaterial.id) === false; else loading">
            <div class="list-files mb-4" *ngIf="collectionMaterials.get(collectionMaterial.id).length > 0">
              <div class="row no-gutters">
                <div class="col-3">
                  <ng-container *ngIf="materialLanguages.get(collectionMaterial.id).length > 1">
                    <h3
                      [id]="'selectLanguage' + collectionMaterial.id"
                    >{{ 'materialPreview.selectLanguage' | translate }}</h3>

                    <div class="btn-group mb-3" role="group" [attr.aria-labelledby]="'selectLanguage' + collectionMaterial.id">
                      <button
                        type="button"
                        class="btn btn-gray"
                        *ngFor="let lang of materialLanguages.get(collectionMaterial.id)"
                        [ngClass]="lang === selectedLanguages.get(collectionMaterial.id) ? 'active' : ''"
                        [attr.aria-selected]="lang === selectedLanguages.get(collectionMaterial.id)"
                        [attr.aria-controls]="'fileList-' + collectionMaterial.id + '-' + lang"
                        [id]="'langSelector-' + collectionMaterial.id + '-' + lang"
                        role="tab"
                        (click)="setSelectedLanguage(collectionMaterial.id, lang)"
                      >{{ lang }}</button>
                    </div>
                  </ng-container>

                  <div
                    *ngIf="collectionMaterials.get(collectionMaterial.id) | materialLanguage:selectedLanguages.get(collectionMaterial.id) as materials"
                    [id]="'fileList-' + collectionMaterial.id + '-' + selectedLanguages.get(collectionMaterial.id)"
                    role="tabpanel"
                    [attr.aria-labelledby]="'langSelector-' + collectionMaterial.id + '-' + selectedLanguages.get(collectionMaterial.id)"
                  >
                    <h3
                      [id]="'selectMaterial' + collectionMaterial.id"
                      [ngClass]="materials.length === 1 ? 'sr-only' : ''"
                    >{{ 'materialPreview.selectMaterial' | translate }}</h3>

                    <div class="btn-group-vertical" role="group" [attr.aria-labelledby]="'selectMaterial' + collectionMaterial.id">
                      <ng-container *ngFor="let material of materials">
                        <button
                          type="button"
                          class="btn btn-file text-dark"
                          [ngClass]="material === previewMaterials.get(collectionMaterial.id) ? 'active' : ''"
                          [attr.aria-selected]="material === previewMaterials.get(collectionMaterial.id)"
                          [attr.aria-controls]="'filePreview-' + collectionMaterial.id + '-' + material.id"
                          [id]="'fileSelector-' + collectionMaterial.id + '-' + material.id"
                          role="tab"
                          (click)="setPreviewMaterial(collectionMaterial.id, material)"
                        >{{ material.displayName[lang] }}</button>
                      </ng-container>
                    </div>
                  </div>
                </div>

                <div class="col-9">
                  <div
                    [id]="'filePreview-' + collectionMaterial.id + '-' + previewMaterials.get(collectionMaterial.id).id"
                    role="tabpanel"
                    [attr.aria-labelledby]="'fileSelector-' + collectionMaterial.id + '-' + previewMaterials.get(collectionMaterial.id).id"
                  >
                    <app-educational-material-preview
                      [material]="previewMaterials.get(collectionMaterial.id)"
                      [isCollection]="true"
                      *ngIf="!previewMaterials.get(collectionMaterial.id).link; else linkPreview"></app-educational-material-preview>

                    <ng-template #linkPreview>
                      <div class="link-preview">
                        <a
                          [href]="previewMaterials.get(collectionMaterial.id).link"
                          class="btn btn-secondary"
                          target="_blank"
                          rel="noopener nofollow"
                        >{{ 'demo.educationalMaterial.preview.openInNewTab' | translate }}</a>
                      </div>
                    </ng-template>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <ng-template #loading>
            <div class="spinner-border" role="status">
              <span class="sr-only">{{ 'collections.loading' | translate }}</span>
            </div>
          </ng-template>
        </div>
      </ng-container>

      <ng-template #noMaterials>
        {{ 'collections.noMaterials' | translate }}
      </ng-template>
    </ng-container>
  </div>
</div>
